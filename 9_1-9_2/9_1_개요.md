## 9. 옵티마이저와 힌트
MySQL 서버로 전달된 쿼리는 결과는 동일하더라도, 내부적으로 최적의 실행 경로와 최소한의 비용이 드는 방식을 선택해 실행된다.
이를 위해 **MySQL은 옵티마이저**를 사용하여, 각 테이블의 데이터 분포 등을 고려해 최적의 실행 계획을 수립한다.
- MySQL에서는 EXPLAIN 명령어를 통해 쿼리의 실행 계획을 확인할 수 있다
<br>

## 9.1 개요
DBMS에서 쿼리의 실행 계획을 수립하는 **옵티마이저는 가장 복잡하고 핵심적인 컴포넌트** 중 하나이다.

<br>

### 9.1.1 쿼리 실행 절차
MySQL에서 쿼리가 실행되는 과정은 크게 세 단계로 이루어진다.

1. SQL 파싱
- SQL 파서(parser) 모듈이 문장을 분석하여 **파스 트리**를 생성한다.
- MySQL 서버는 SQL 문장을 직접 실행하는 것이 아니라, 이 파스 트리를 기반으로 쿼리를 실행한다.
- 즉, SQL 문장을 MySQL이 이해할 수 있는 구조로 분해하는 단계이다.

2. 최적화 및 실행 계획 수립
- **불필요한 조건 제거, 복잡한 연산의 단순화** 등 여러 최적화 작업이 수행된다.
- 이 단계는 **옵티마이저**가 담당하며, 파스 트리를 분석해 **테이블의 읽기 순서, 사용할 인덱스** 등을 결정한다.

3. 실행
- 수립된 실행 계획에 따라 **스토리지 엔진에 레코드 읽기를 요청**하고, 실제 작업을 수행한다.
- 이때 결정된 **인덱스 사용 여부**와 **테이블 접근 순서**에 따라 데이터가 읽혀진다.

<br>

> 첫 번째와 두 번째 단계는 대부분 MySQL 엔진에서 처리되며, 세 번째 단계는 MySQL 엔진과 스토리지 엔진이 협력하여 수행된다.

<br>

### 9.1.2 옵티마이저의 종류
옵티마이저는 크게 **규칙 기반 최적화**와 **비용 기반 최적화**로 나뉜다.
대부분의 현대 DBMS는 **비용 기반 최적화**를 채택하고 있으며, 오라클의 초기 버전에서는 규칙 기반 최적화가 주로 사용되었다.

- **규칙 기반 최적화**
  - 쿼리 실행 계획을 수립할 때, **사전에 정의된 고정된 규칙**에 따라 실행 계획을 선택하는 방식이다.
  - 같은 쿼리에 대해서 항상 동일한 실행 계획을 선택하며, **통계 정보나 데이터 분포를 고려하지 않는다.**
  - 이러한 단순함 때문에 현재는 거의 사용되지 않는다.
- **비용 기반 최적화**
  - 쿼리 실행 시 고려 가능한 여러 실행 계획을 생성한 후, **각 계획에 대한 예상 비용을 계산**하여 가장 효율적인 실행 계획을 선택하는 방식이다.
  - 이때의 비용은 **디스크 I/O, CPU 사용량, 네트워크 비용** 등을 종합적으로 고려하여 평가된다.
  - **MySQL은 비용 기반 최적화를 사용**하며, 실행 계획 수립 시 **통계 정보와 인덱스 정보 등을 활용**한다.

<br>
